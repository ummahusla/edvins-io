---
title: Building a "Welcome Back" screen for idle games
description: Learn how to build the classic idle-game "Welcome Back" mechanic in React ‚Äî calculate offline progress, handle tab visibility, and make your players feel rewarded for returning.
date: 2025-10-27
tags:
  - React
  - Game Dev
---

Idle games feel magical because progress happens even when you‚Äôre not there.
That moment when you open the game and it says:

> ‚ÄúWelcome back! You were gone for 14 minutes and earned 280 wood.‚Äù

That‚Äôs what keeps players hooked.

In this post, we‚Äôll build a **Chop Tree** system that continuously generates wood while you play ‚Äî and keeps working while you‚Äôre away.
It tracks time, rewards you fairly on return, and even resumes automatically after a refresh.

---

### How it works

We‚Äôll use three key pieces of data:

- When the action started (`actionStartAt`)
- The last progress timestamp (`progressAnchor`)
- Whether the action is active

Every 3 seconds, you gain 1 wood.
If you leave, close the tab, or switch away, the game calculates how much time passed and adds up the missing ticks (up to 1 hour).

Here‚Äôs the updated flow:

```mermaid
flowchart TD
    A[Start Chopping] --> B[Record timestamps in localStorage]
    B --> C[Every 3 seconds: +1 wood]
    C --> D[Tab hidden or closed]
    D --> E[Record last active time]
    E --> F[User returns or refocuses tab]
    F --> G[Compare timestamps and award wood (1 wood / 3s)]
    G --> H[Show message: "You were away for 2m and earned 40 wood"]
    H --> C
```

![](/posts/building-a-welcome-back-screen-for-idle-games/welcome-back-page-flow.png)

### The React implementation

We‚Äôll keep everything self-contained in a React hook and one simple component.

```tsx
import { useEffect, useState } from 'react';

const WOOD_PER_MINUTE = 100;

export function useIdleProgress() {
  const [wood, setWood] = useState(0);

  // Save timestamp and progress on exit
  useEffect(() => {
    const handleBeforeUnload = () => {
      localStorage.setItem('lastActive', Date.now().toString());
      localStorage.setItem('wood', wood.toString());
    };
    window.addEventListener('beforeunload', handleBeforeUnload);
    return () => window.removeEventListener('beforeunload', handleBeforeUnload);
  }, [wood]);

  // Calculate offline progress on load
  useEffect(() => {
    const savedWood = parseInt(localStorage.getItem('wood') || '0', 10);
    const savedTime = localStorage.getItem('lastActive');
    const now = Date.now();

    if (savedTime) {
      const diffMs = now - parseInt(savedTime);
      const diffMinutes = diffMs / 60000;
      const cappedMinutes = Math.min(diffMinutes, 480); // 8-hour cap

      const earned = Math.floor(cappedMinutes * WOOD_PER_MINUTE); // 100 wood/min
      const total = savedWood + earned;

      setWood(total);

      if (earned > 0) {
        alert(
          `üå≤ Welcome back! You were away for ${Math.floor(
            diffMinutes
          )} minutes and earned ${earned} wood!`
        );
      }
    } else {
      setWood(savedWood);
    }
  }, []);

  return { wood, setWood };
}
```

### Building the UI

```tsx
import React from 'react';
import { useIdleProgress } from './useIdleProgress';

export default function ChopTree() {
  const { wood, setWood } = useIdleProgress();

  const chopTree = () => setWood((prev) => prev + 1);

  return (
    <div className="p-6 text-center text-white bg-slate-900 min-h-screen">
      <h1 className="text-3xl font-bold mb-4">üå≤ Chop Tree Idle Demo</h1>
      <p className="mb-2 text-lg">You have {wood} wood.</p>
      <button
        onClick={chopTree}
        className="bg-green-600 px-4 py-2 rounded-xl hover:bg-green-500 transition"
      >
        Chop Tree
      </button>
      <p className="mt-6 text-sm opacity-70">Close the tab and come back later!</p>
    </div>
  );
}
```

### Playable demo

<IdleWelcomeDemo />

### Why localStorage is not secure

This version works fine for learning, but it‚Äôs easy to cheat.
Anyone can open DevTools and set their last active timestamp to zero:

```js
localStorage.setItem('lastActive', '0');
```

---

### Making it secure with Supabase

In a real setup, the server should track time and handle calculations.
That way, you can‚Äôt trick the system by editing local data or your computer clock.

| Column           | Type        | Description                            |
| ---------------- | ----------- | -------------------------------------- |
| id               | uuid        | Player ID                              |
| wood             | int         | Total wood collected                   |
| last_active      | timestamptz | Last seen time                         |
| last_login_bonus | timestamptz | When the last offline reward was given |

Here‚Äôs what the server-side logic could look like:

```ts
import { supabase } from '../lib/supabase';

async function getOfflineEarnings(userId: string) {
  const { data } = await supabase.from('profiles').select('*').eq('id', userId).single();
  const now = new Date();
  const lastActive = new Date(data.last_active);

  const diffMs = now.getTime() - lastActive.getTime();
  const diffMinutes = diffMs / 60000;
  const cappedMinutes = Math.min(diffMinutes, 480); // 8-hour cap
  const earned = Math.floor(cappedMinutes * 1); // 1 wood/min

  await supabase
    .from('profiles')
    .update({
      wood: data.wood + earned,
      last_active: now.toISOString(),
    })
    .eq('id', userId);

  return earned;
}
```

When the player opens the game again, call this function and show the message:

```js
alert(`üå≤ Welcome back! You earned ${earned} wood while you were away.`);
```

---

### Small anti-cheat improvements

Even with server validation, add some extra safety checks:

- Always clamp offline duration to 8 hours.
- Apply the offline reward only once per session.
- Prevent multiple quick reloads from stacking rewards.
- Calculate rewards entirely on the server.

These checks stop most casual cheats before they start.

---

### Making it feel rewarding

The math is one thing, but presentation makes the difference.

Try adding:

- A smooth popup animation for ‚ÄúWelcome Back‚Äù.
- A counter animation as wood increases.
- A soft sound or sparkle when showing rewards.

It‚Äôs a small feature that gives your idle game personality.
Players love feeling like their world kept moving without them.

---

Wrapping up

What we built:

- A working ‚ÄúWelcome Back‚Äù system in React.
- A local version for demo purposes.
- A secure Supabase-based approach for production.

This pattern is used in every idle game ‚Äî from chopping trees to mining gold to farming crops.
It‚Äôs the mechanic that keeps players coming back.

Next, we‚Äôll explore how to save player progress safely and sync it between sessions.
